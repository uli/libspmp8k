#!/bin/sh
set -e
gcc-4.7 -g -O0 -Wall -W -DTEST_BUILD -m32 -g -o test_abi test_abi.c libgame.c
function do_test {
	name=$1
	shift
	./test_abi ./test_fw/${name}.rap $@ >out
	diff -u ./test_fw/${name}.out out
	rm out
}
# specify addresses of diag_printf (0x4), MCatchInitGraph (0x38),
# NativeGE_fsOpen (0x13c), NativeGE_fsRead (0x140), NativeGE_fsWrite (0x144),
# MCatchPaint (0x10), NativeGE_getKeyInput4Ntv (0x100), gFunTable, NativeGE_gamePause
do_test jxd100     0x297d90 0x2ced3c 0x42488c 0x4245f0 0x424594 0x2cd008 0x2c39dc 0x65c39c 0x425ae4
do_test sk8607     0x2c2fdc 0x2f40c4 0x2f15dc 0x2f16ac 0x2f170c 0x2f22d0 0x2f1984 0x55b578 0x2f05b4
do_test mmm-2      0x298b64 0x2df000 0x462a6c 0x462b40 0x462ba8 0x2dd20c 0x2d2f7c 0x5efb54 0x461904
do_test mmm-3.1    0x298b64 0x2df000 0x462a74 0x462b48 0x462bb0 0x2dd20c 0x2d2f7c 0x5efb74 0x46190c
do_test a1000      0x298160 0x328d18 0x429f08 0x429c88 0x429c2c 0x326fe4 0x326b38 0x676018 0x42b100
do_test jxd1000    0x298188 0x2dee40 0x470614 0x4706e8 0x470750 0x2dd04c 0x2d311c 0x618734 0x46f4ac
do_test jxd-v3     0x297df4 0x2ddf3c 0x46b554 0x46b698 0x46b700 0x2dc148 0x2d2234 0x5f5614 0x46a32c
do_test letcool2.1 0x298b64 0x2df010 0x462a58 0x462b2c 0x462b94 0x2dd21c 0x2d2f7c 0x5efb94 0x4618f0
do_test pgp200b    0x2e98ec 0x2e493c 0x44c3d0 0x44c4a0 0x44c500 0x2e2b48 0x2d8bec 0x5c7cd4 0x44b268
do_test 1000plus   0x297e58 0x2d2658 0x42d55c 0x42d2d8 0x42d27c 0x2d08f8 0x2c72d4 0x6ea1b8 0x42e76c
do_test v1000      0x298188 0x2def68 0x472674 0x472748 0x4727b0 0x2dd174 0x2d3244 0x61b174 0x47150c
do_test a16        0x2d5e58 0x2cf05c 0x447768 0x44787c 0x447900 0x2cd248 0x2c3144 0x5d21c8 0x446744
do_test jxd2000    0x2d7bd8 0x2d21f4 0x2fbed4 0x2fbfa4 0x2fc004 0x2d0400 0x2c6668 0x57bb5c 0x2fae48
do_test jxd300     0x29818c 0x2de10c 0x476f8c 0x477060 0x4770c8 0x2dc318 0x2d23e4 0x61f0b4 0x475e24
do_test v5000      0x297ed0 0x2d322c 0x44ac38 0x44a9b0 0x44a954 0x2d14cc 0x2c7c00 0x68fff8 0x44be30
